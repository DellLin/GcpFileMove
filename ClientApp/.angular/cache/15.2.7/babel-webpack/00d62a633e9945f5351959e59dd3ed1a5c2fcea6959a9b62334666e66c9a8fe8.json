{"ast":null,"code":"import * as i0 from \"@angular/core\";\nimport * as i1 from \"./storage.service\";\nimport * as i2 from \"@angular/common\";\nfunction AppComponent_tr_26_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r5 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"td\");\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"td\")(6, \"button\", 12);\n    i0.ɵɵlistener(\"click\", function AppComponent_tr_26_Template_button_click_6_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r5);\n      const file_r3 = restoredCtx.$implicit;\n      const ctx_r4 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r4.downloadFile(file_r3.uuidFileName));\n    });\n    i0.ɵɵtext(7, \"Download\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"button\", 13);\n    i0.ɵɵlistener(\"click\", function AppComponent_tr_26_Template_button_click_8_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r5);\n      const file_r3 = restoredCtx.$implicit;\n      const ctx_r6 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r6.deleteFile(file_r3.uuidFileName));\n    });\n    i0.ɵɵtext(9, \"Delete\");\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const file_r3 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(file_r3.originalFileName);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(file_r3.uuidFileName);\n  }\n}\nfunction AppComponent_div_27_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 14);\n    i0.ɵɵtext(1, \" No files uploaded yet. \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction AppComponent_tr_40_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r9 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"td\")(4, \"button\", 12);\n    i0.ɵɵlistener(\"click\", function AppComponent_tr_40_Template_button_click_4_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r9);\n      const file_r7 = restoredCtx.$implicit;\n      const ctx_r8 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r8.downloadFile(file_r7.name));\n    });\n    i0.ɵɵtext(5, \"Download\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"button\", 13);\n    i0.ɵɵlistener(\"click\", function AppComponent_tr_40_Template_button_click_6_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r9);\n      const file_r7 = restoredCtx.$implicit;\n      const ctx_r10 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r10.deleteFile(file_r7.name));\n    });\n    i0.ɵɵtext(7, \"Delete\");\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const file_r7 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(file_r7.name);\n  }\n}\nexport let AppComponent = /*#__PURE__*/(() => {\n  class AppComponent {\n    constructor(storageService) {\n      this.storageService = storageService;\n      this.title = 'app';\n      this.files = [];\n      this.selectedFile = null;\n      this.uploadedFiles = []; // 儲存上傳的檔案資訊\n    }\n\n    ngOnInit() {\n      this.loadFiles();\n    }\n    loadFiles() {\n      this.storageService.getFileList().subscribe(data => {\n        this.files = data.items;\n      });\n    }\n    onFileSelected(event) {\n      this.selectedFile = event.target.files[0];\n    }\n    onUpload() {\n      if (this.selectedFile) {\n        this.storageService.uploadFile(this.selectedFile).subscribe(response => {\n          // 將上傳的檔案資訊加入到列表中\n          this.uploadedFiles.push({\n            uuidFileName: response.uuidFileName,\n            originalFileName: response.originalFileName\n          });\n          this.loadFiles();\n          this.selectedFile = null;\n        });\n      }\n    }\n    downloadFile(uuidFileName) {\n      // 使用簡化的下載方法，直接開啟下載連結\n      this.storageService.downloadFile(uuidFileName);\n    }\n    // 如果需要更複雜的下載處理，可以使用這個方法\n    downloadFileAsBlob(uuidFileName) {\n      this.storageService.downloadFileAsBlob(uuidFileName).subscribe(blob => {\n        const a = document.createElement('a');\n        const objectUrl = URL.createObjectURL(blob);\n        a.href = objectUrl;\n        a.download = `downloaded_${uuidFileName}`; // 使用 UUID 作為預設檔案名稱\n        a.click();\n        URL.revokeObjectURL(objectUrl);\n      });\n    }\n    deleteFile(uuidFileName) {\n      this.storageService.deleteFile(uuidFileName).subscribe(() => {\n        // 從本地列表中移除已刪除的檔案\n        this.uploadedFiles = this.uploadedFiles.filter(f => f.uuidFileName !== uuidFileName);\n        this.loadFiles();\n      });\n    }\n  }\n  AppComponent.ɵfac = function AppComponent_Factory(t) {\n    return new (t || AppComponent)(i0.ɵɵdirectiveInject(i1.StorageService));\n  };\n  AppComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: AppComponent,\n    selectors: [[\"app-root\"]],\n    decls: 41,\n    vars: 4,\n    consts: [[1, \"container\"], [1, \"card\", \"mb-4\"], [1, \"card-body\"], [1, \"card-title\"], [1, \"form-group\"], [\"type\", \"file\", 1, \"form-control-file\", 3, \"change\"], [1, \"btn\", \"btn-primary\", 3, \"disabled\", \"click\"], [1, \"card\"], [1, \"table\", \"table-striped\"], [4, \"ngFor\", \"ngForOf\"], [\"class\", \"text-muted\", 4, \"ngIf\"], [1, \"card\", \"mt-4\"], [1, \"btn\", \"btn-success\", \"btn-sm\", \"mr-2\", 3, \"click\"], [1, \"btn\", \"btn-danger\", \"btn-sm\", 3, \"click\"], [1, \"text-muted\"]],\n    template: function AppComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"body\")(1, \"div\", 0)(2, \"h1\");\n        i0.ɵɵtext(3, \"GCP Storage File Management\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(4, \"div\", 1)(5, \"div\", 2)(6, \"h5\", 3);\n        i0.ɵɵtext(7, \"Upload File\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(8, \"div\", 4)(9, \"input\", 5);\n        i0.ɵɵlistener(\"change\", function AppComponent_Template_input_change_9_listener($event) {\n          return ctx.onFileSelected($event);\n        });\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(10, \"button\", 6);\n        i0.ɵɵlistener(\"click\", function AppComponent_Template_button_click_10_listener() {\n          return ctx.onUpload();\n        });\n        i0.ɵɵtext(11, \"Upload\");\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵelementStart(12, \"div\", 7)(13, \"div\", 2)(14, \"h5\", 3);\n        i0.ɵɵtext(15, \"Uploaded Files\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(16, \"table\", 8)(17, \"thead\")(18, \"tr\")(19, \"th\");\n        i0.ɵɵtext(20, \"Original File Name\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(21, \"th\");\n        i0.ɵɵtext(22, \"UUID File Name\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(23, \"th\");\n        i0.ɵɵtext(24, \"Actions\");\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵelementStart(25, \"tbody\");\n        i0.ɵɵtemplate(26, AppComponent_tr_26_Template, 10, 2, \"tr\", 9);\n        i0.ɵɵelementEnd()();\n        i0.ɵɵtemplate(27, AppComponent_div_27_Template, 2, 0, \"div\", 10);\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(28, \"div\", 11)(29, \"div\", 2)(30, \"h5\", 3);\n        i0.ɵɵtext(31, \"All Files in Storage (Raw API Response)\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(32, \"table\", 8)(33, \"thead\")(34, \"tr\")(35, \"th\");\n        i0.ɵɵtext(36, \"File Name (UUID)\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(37, \"th\");\n        i0.ɵɵtext(38, \"Actions\");\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵelementStart(39, \"tbody\");\n        i0.ɵɵtemplate(40, AppComponent_tr_40_Template, 8, 1, \"tr\", 9);\n        i0.ɵɵelementEnd()()()()()();\n      }\n      if (rf & 2) {\n        i0.ɵɵadvance(10);\n        i0.ɵɵproperty(\"disabled\", !ctx.selectedFile);\n        i0.ɵɵadvance(16);\n        i0.ɵɵproperty(\"ngForOf\", ctx.uploadedFiles);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.uploadedFiles.length === 0);\n        i0.ɵɵadvance(13);\n        i0.ɵɵproperty(\"ngForOf\", ctx.files);\n      }\n    },\n    dependencies: [i2.NgForOf, i2.NgIf],\n    encapsulation: 2\n  });\n  return AppComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}