{"ast":null,"code":"import * as i0 from \"@angular/core\";\nimport * as i1 from \"./storage.service\";\nimport * as i2 from \"@angular/common\";\nfunction AppComponent_tr_36_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r7 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"td\");\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"td\");\n    i0.ɵɵtext(6);\n    i0.ɵɵpipe(7, \"number\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"td\");\n    i0.ɵɵtext(9);\n    i0.ɵɵpipe(10, \"date\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(11, \"td\")(12, \"button\", 17);\n    i0.ɵɵlistener(\"click\", function AppComponent_tr_36_Template_button_click_12_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r7);\n      const file_r5 = restoredCtx.$implicit;\n      const ctx_r6 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r6.downloadFile(file_r5.uuidFileName));\n    });\n    i0.ɵɵtext(13, \"Download\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(14, \"button\", 18);\n    i0.ɵɵlistener(\"click\", function AppComponent_tr_36_Template_button_click_14_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r7);\n      const file_r5 = restoredCtx.$implicit;\n      const ctx_r8 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r8.deleteFile(file_r5.uuidFileName));\n    });\n    i0.ɵɵtext(15, \"Delete\");\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const file_r5 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(file_r5.originalFileName);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(file_r5.uuidFileName);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(7, 4, file_r5.size));\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind2(10, 6, file_r5.uploadDate, \"short\"));\n  }\n}\nfunction AppComponent_div_37_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 13);\n    i0.ɵɵtext(1, \" No files found in storage. \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction AppComponent_tr_52_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r11 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"td\");\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"td\")(6, \"button\", 17);\n    i0.ɵɵlistener(\"click\", function AppComponent_tr_52_Template_button_click_6_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r11);\n      const file_r9 = restoredCtx.$implicit;\n      const ctx_r10 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r10.downloadFile(file_r9.uuidFileName));\n    });\n    i0.ɵɵtext(7, \"Download\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"button\", 18);\n    i0.ɵɵlistener(\"click\", function AppComponent_tr_52_Template_button_click_8_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r11);\n      const file_r9 = restoredCtx.$implicit;\n      const ctx_r12 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r12.deleteFile(file_r9.uuidFileName));\n    });\n    i0.ɵɵtext(9, \"Delete\");\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const file_r9 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(file_r9.originalFileName);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(file_r9.uuidFileName);\n  }\n}\nfunction AppComponent_div_53_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 13);\n    i0.ɵɵtext(1, \" No files uploaded in this session. \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction AppComponent_tr_66_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r15 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"td\")(4, \"button\", 17);\n    i0.ɵɵlistener(\"click\", function AppComponent_tr_66_Template_button_click_4_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r15);\n      const file_r13 = restoredCtx.$implicit;\n      const ctx_r14 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r14.downloadFile(file_r13.name));\n    });\n    i0.ɵɵtext(5, \"Download\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"button\", 18);\n    i0.ɵɵlistener(\"click\", function AppComponent_tr_66_Template_button_click_6_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r15);\n      const file_r13 = restoredCtx.$implicit;\n      const ctx_r16 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r16.deleteFile(file_r13.name));\n    });\n    i0.ɵɵtext(7, \"Delete\");\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const file_r13 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(file_r13.name);\n  }\n}\nexport class AppComponent {\n  constructor(storageService) {\n    this.storageService = storageService;\n    this.title = 'app';\n    this.files = [];\n    this.filesWithMetadata = []; // 帶有原始檔案名稱的檔案列表\n    this.selectedFile = null;\n    this.uploadedFiles = []; // 儲存上傳的檔案資訊\n    this.sortDescending = true; // 排序方向：true = 降序（最新在前），false = 升序（最舊在前）\n  }\n\n  ngOnInit() {\n    this.loadFiles();\n  }\n  loadFiles() {\n    // 載入原始的檔案列表（舊版 API）\n    this.storageService.getFileList().subscribe(data => {\n      this.files = data.items || [];\n    });\n    // 載入帶有元數據的檔案列表（新版 API）\n    this.storageService.getFileListWithMetadata().subscribe(data => {\n      this.filesWithMetadata = data;\n      this.sortFilesByDate();\n    });\n  }\n  sortFilesByDate() {\n    this.filesWithMetadata.sort((a, b) => {\n      const dateA = new Date(a.uploadDate).getTime();\n      const dateB = new Date(b.uploadDate).getTime();\n      return this.sortDescending ? dateB - dateA : dateA - dateB;\n    });\n  }\n  toggleSortOrder() {\n    this.sortDescending = !this.sortDescending;\n    this.sortFilesByDate();\n  }\n  onFileSelected(event) {\n    this.selectedFile = event.target.files[0];\n  }\n  onUpload() {\n    if (this.selectedFile) {\n      this.storageService.uploadFile(this.selectedFile).subscribe(response => {\n        // 將上傳的檔案資訊加入到列表中\n        this.uploadedFiles.push({\n          uuidFileName: response.uuidFileName,\n          originalFileName: response.originalFileName\n        });\n        this.loadFiles();\n        this.selectedFile = null;\n      });\n    }\n  }\n  downloadFile(uuidFileName) {\n    // 使用簡化的下載方法，直接開啟下載連結\n    this.storageService.downloadFile(uuidFileName);\n  }\n  // 如果需要更複雜的下載處理，可以使用這個方法\n  downloadFileAsBlob(uuidFileName) {\n    this.storageService.downloadFileAsBlob(uuidFileName).subscribe(blob => {\n      const a = document.createElement('a');\n      const objectUrl = URL.createObjectURL(blob);\n      a.href = objectUrl;\n      a.download = `downloaded_${uuidFileName}`; // 使用 UUID 作為預設檔案名稱\n      a.click();\n      URL.revokeObjectURL(objectUrl);\n    });\n  }\n  deleteFile(uuidFileName) {\n    this.storageService.deleteFile(uuidFileName).subscribe(() => {\n      // 從本地列表中移除已刪除的檔案\n      this.uploadedFiles = this.uploadedFiles.filter(f => f.uuidFileName !== uuidFileName);\n      this.loadFiles();\n    });\n  }\n}\nAppComponent.ɵfac = function AppComponent_Factory(t) {\n  return new (t || AppComponent)(i0.ɵɵdirectiveInject(i1.StorageService));\n};\nAppComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: AppComponent,\n  selectors: [[\"app-root\"]],\n  decls: 67,\n  vars: 8,\n  consts: [[1, \"container\"], [1, \"card\", \"mb-4\"], [1, \"card-body\"], [1, \"card-title\"], [1, \"form-group\"], [\"type\", \"file\", 1, \"form-control-file\", 3, \"change\"], [1, \"btn\", \"btn-primary\", 3, \"disabled\", \"click\"], [1, \"card\"], [1, \"d-flex\", \"justify-content-between\", \"align-items-center\", \"mb-3\"], [1, \"card-title\", \"mb-0\"], [1, \"btn\", \"btn-outline-secondary\", \"btn-sm\", 3, \"click\"], [1, \"fas\", \"fa-sort\"], [1, \"table\", \"table-striped\"], [1, \"text-muted\"], [4, \"ngFor\", \"ngForOf\"], [\"class\", \"text-muted\", 4, \"ngIf\"], [1, \"card\", \"mt-4\"], [1, \"btn\", \"btn-success\", \"btn-sm\", \"mr-2\", 3, \"click\"], [1, \"btn\", \"btn-danger\", \"btn-sm\", 3, \"click\"]],\n  template: function AppComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵelementStart(0, \"body\")(1, \"div\", 0)(2, \"h1\");\n      i0.ɵɵtext(3, \"GCP Storage File Management\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(4, \"div\", 1)(5, \"div\", 2)(6, \"h5\", 3);\n      i0.ɵɵtext(7, \"Upload File\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(8, \"div\", 4)(9, \"input\", 5);\n      i0.ɵɵlistener(\"change\", function AppComponent_Template_input_change_9_listener($event) {\n        return ctx.onFileSelected($event);\n      });\n      i0.ɵɵelementEnd()();\n      i0.ɵɵelementStart(10, \"button\", 6);\n      i0.ɵɵlistener(\"click\", function AppComponent_Template_button_click_10_listener() {\n        return ctx.onUpload();\n      });\n      i0.ɵɵtext(11, \"Upload\");\n      i0.ɵɵelementEnd()()();\n      i0.ɵɵelementStart(12, \"div\", 7)(13, \"div\", 2)(14, \"div\", 8)(15, \"h5\", 9);\n      i0.ɵɵtext(16, \"All Files with Original Names\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(17, \"button\", 10);\n      i0.ɵɵlistener(\"click\", function AppComponent_Template_button_click_17_listener() {\n        return ctx.toggleSortOrder();\n      });\n      i0.ɵɵelement(18, \"i\", 11);\n      i0.ɵɵtext(19);\n      i0.ɵɵelementEnd()();\n      i0.ɵɵelementStart(20, \"table\", 12)(21, \"thead\")(22, \"tr\")(23, \"th\");\n      i0.ɵɵtext(24, \"Original File Name\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(25, \"th\");\n      i0.ɵɵtext(26, \"UUID File Name\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(27, \"th\");\n      i0.ɵɵtext(28, \"Size (bytes)\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(29, \"th\");\n      i0.ɵɵtext(30, \" Upload Date \");\n      i0.ɵɵelementStart(31, \"span\", 13);\n      i0.ɵɵtext(32);\n      i0.ɵɵelementEnd()();\n      i0.ɵɵelementStart(33, \"th\");\n      i0.ɵɵtext(34, \"Actions\");\n      i0.ɵɵelementEnd()()();\n      i0.ɵɵelementStart(35, \"tbody\");\n      i0.ɵɵtemplate(36, AppComponent_tr_36_Template, 16, 9, \"tr\", 14);\n      i0.ɵɵelementEnd()();\n      i0.ɵɵtemplate(37, AppComponent_div_37_Template, 2, 0, \"div\", 15);\n      i0.ɵɵelementEnd()();\n      i0.ɵɵelementStart(38, \"div\", 16)(39, \"div\", 2)(40, \"h5\", 3);\n      i0.ɵɵtext(41, \"Recently Uploaded Files (This Session)\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(42, \"table\", 12)(43, \"thead\")(44, \"tr\")(45, \"th\");\n      i0.ɵɵtext(46, \"Original File Name\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(47, \"th\");\n      i0.ɵɵtext(48, \"UUID File Name\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(49, \"th\");\n      i0.ɵɵtext(50, \"Actions\");\n      i0.ɵɵelementEnd()()();\n      i0.ɵɵelementStart(51, \"tbody\");\n      i0.ɵɵtemplate(52, AppComponent_tr_52_Template, 10, 2, \"tr\", 14);\n      i0.ɵɵelementEnd()();\n      i0.ɵɵtemplate(53, AppComponent_div_53_Template, 2, 0, \"div\", 15);\n      i0.ɵɵelementEnd()();\n      i0.ɵɵelementStart(54, \"div\", 16)(55, \"div\", 2)(56, \"h5\", 3);\n      i0.ɵɵtext(57, \"Raw Storage API Response\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(58, \"table\", 12)(59, \"thead\")(60, \"tr\")(61, \"th\");\n      i0.ɵɵtext(62, \"File Name (UUID)\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(63, \"th\");\n      i0.ɵɵtext(64, \"Actions\");\n      i0.ɵɵelementEnd()()();\n      i0.ɵɵelementStart(65, \"tbody\");\n      i0.ɵɵtemplate(66, AppComponent_tr_66_Template, 8, 1, \"tr\", 14);\n      i0.ɵɵelementEnd()()()()()();\n    }\n    if (rf & 2) {\n      i0.ɵɵadvance(10);\n      i0.ɵɵproperty(\"disabled\", !ctx.selectedFile);\n      i0.ɵɵadvance(9);\n      i0.ɵɵtextInterpolate1(\" Sort by Date: \", ctx.sortDescending ? \"Newest First\" : \"Oldest First\", \" \");\n      i0.ɵɵadvance(13);\n      i0.ɵɵtextInterpolate1(\" \", ctx.sortDescending ? \"(\\u2193 Newest First)\" : \"(\\u2191 Oldest First)\", \" \");\n      i0.ɵɵadvance(4);\n      i0.ɵɵproperty(\"ngForOf\", ctx.filesWithMetadata);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", ctx.filesWithMetadata.length === 0);\n      i0.ɵɵadvance(15);\n      i0.ɵɵproperty(\"ngForOf\", ctx.uploadedFiles);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", ctx.uploadedFiles.length === 0);\n      i0.ɵɵadvance(13);\n      i0.ɵɵproperty(\"ngForOf\", ctx.files);\n    }\n  },\n  dependencies: [i2.NgForOf, i2.NgIf, i2.DecimalPipe, i2.DatePipe],\n  encapsulation: 2\n});","map":{"version":3,"mappings":"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","names":["i0","AppComponent","constructor","storageService","ngOnInit","loadFiles","getFileList","subscribe","data","files","items","getFileListWithMetadata","filesWithMetadata","sortFilesByDate","sort","a","b","dateA","Date","uploadDate","getTime","dateB","sortDescending","toggleSortOrder","onFileSelected","event","selectedFile","target","onUpload","uploadFile","response","uploadedFiles","push","uuidFileName","originalFileName","downloadFile","downloadFileAsBlob","blob","document","createElement","objectUrl","URL","createObjectURL","href","download","click","revokeObjectURL","deleteFile","filter","f","selectors","decls","vars","consts","template","ctx"],"sourceRoot":"","sources":["/Users/delllin/Projects/GcpFileMove/ClientApp/src/app/app.component.html","/Users/delllin/Projects/GcpFileMove/ClientApp/src/app/app.component.ts"],"sourcesContent":["<body>\n  <div class=\"container\">\n    <h1>GCP Storage File Management</h1>\n\n    <div class=\"card mb-4\">\n      <div class=\"card-body\">\n        <h5 class=\"card-title\">Upload File</h5>\n        <div class=\"form-group\">\n          <input type=\"file\" (change)=\"onFileSelected($event)\" class=\"form-control-file\">\n        </div>\n        <button (click)=\"onUpload()\" class=\"btn btn-primary\" [disabled]=\"!selectedFile\">Upload</button>\n      </div>\n    </div>\n\n    <div class=\"card\">\n      <div class=\"card-body\">\n        <div class=\"d-flex justify-content-between align-items-center mb-3\">\n          <h5 class=\"card-title mb-0\">All Files with Original Names</h5>\n          <button (click)=\"toggleSortOrder()\" class=\"btn btn-outline-secondary btn-sm\">\n            <i class=\"fas fa-sort\"></i>\n            Sort by Date: {{ sortDescending ? 'Newest First' : 'Oldest First' }}\n          </button>\n        </div>\n        <table class=\"table table-striped\">\n          <thead>\n            <tr>\n              <th>Original File Name</th>\n              <th>UUID File Name</th>\n              <th>Size (bytes)</th>\n              <th>\n                Upload Date\n                <span class=\"text-muted\">\n                  {{ sortDescending ? '(↓ Newest First)' : '(↑ Oldest First)' }}\n                </span>\n              </th>\n              <th>Actions</th>\n            </tr>\n          </thead>\n          <tbody>\n            <tr *ngFor=\"let file of filesWithMetadata\">\n              <td>{{ file.originalFileName }}</td>\n              <td>{{ file.uuidFileName }}</td>\n              <td>{{ file.size | number }}</td>\n              <td>{{ file.uploadDate | date:'short' }}</td>\n              <td>\n                <button (click)=\"downloadFile(file.uuidFileName)\" class=\"btn btn-success btn-sm mr-2\">Download</button>\n                <button (click)=\"deleteFile(file.uuidFileName)\" class=\"btn btn-danger btn-sm\">Delete</button>\n              </td>\n            </tr>\n          </tbody>\n        </table>\n\n        <div *ngIf=\"filesWithMetadata.length === 0\" class=\"text-muted\">\n          No files found in storage.\n        </div>\n      </div>\n    </div>\n\n    <div class=\"card mt-4\">\n      <div class=\"card-body\">\n        <h5 class=\"card-title\">Recently Uploaded Files (This Session)</h5>\n        <table class=\"table table-striped\">\n          <thead>\n            <tr>\n              <th>Original File Name</th>\n              <th>UUID File Name</th>\n              <th>Actions</th>\n            </tr>\n          </thead>\n          <tbody>\n            <tr *ngFor=\"let file of uploadedFiles\">\n              <td>{{ file.originalFileName }}</td>\n              <td>{{ file.uuidFileName }}</td>\n              <td>\n                <button (click)=\"downloadFile(file.uuidFileName)\" class=\"btn btn-success btn-sm mr-2\">Download</button>\n                <button (click)=\"deleteFile(file.uuidFileName)\" class=\"btn btn-danger btn-sm\">Delete</button>\n              </td>\n            </tr>\n          </tbody>\n        </table>\n\n        <div *ngIf=\"uploadedFiles.length === 0\" class=\"text-muted\">\n          No files uploaded in this session.\n        </div>\n      </div>\n    </div>\n\n    <div class=\"card mt-4\">\n      <div class=\"card-body\">\n        <h5 class=\"card-title\">Raw Storage API Response</h5>\n        <table class=\"table table-striped\">\n          <thead>\n            <tr>\n              <th>File Name (UUID)</th>\n              <th>Actions</th>\n            </tr>\n          </thead>\n          <tbody>\n            <tr *ngFor=\"let file of files\">\n              <td>{{ file.name }}</td>\n              <td>\n                <button (click)=\"downloadFile(file.name)\" class=\"btn btn-success btn-sm mr-2\">Download</button>\n                <button (click)=\"deleteFile(file.name)\" class=\"btn btn-danger btn-sm\">Delete</button>\n              </td>\n            </tr>\n          </tbody>\n        </table>\n      </div>\n    </div>\n  </div>\n</body>","import { Component, OnInit } from '@angular/core';\nimport { StorageService, UploadResponse, FileMetadata } from './storage.service';\n\n@Component({\n  selector: 'app-root',\n  templateUrl: './app.component.html'\n})\nexport class AppComponent implements OnInit {\n  title = 'app';\n  files: any[] = [];\n  filesWithMetadata: FileMetadata[] = []; // 帶有原始檔案名稱的檔案列表\n  selectedFile: File | null = null;\n  uploadedFiles: { uuidFileName: string, originalFileName: string }[] = []; // 儲存上傳的檔案資訊\n  sortDescending: boolean = true; // 排序方向：true = 降序（最新在前），false = 升序（最舊在前）\n\n  constructor(private storageService: StorageService) { }\n\n  ngOnInit() {\n    this.loadFiles();\n  }\n\n  loadFiles() {\n    // 載入原始的檔案列表（舊版 API）\n    this.storageService.getFileList().subscribe(data => {\n      this.files = data.items || [];\n    });\n\n    // 載入帶有元數據的檔案列表（新版 API）\n    this.storageService.getFileListWithMetadata().subscribe(data => {\n      this.filesWithMetadata = data;\n      this.sortFilesByDate();\n    });\n  }\n\n  sortFilesByDate() {\n    this.filesWithMetadata.sort((a, b) => {\n      const dateA = new Date(a.uploadDate).getTime();\n      const dateB = new Date(b.uploadDate).getTime();\n      return this.sortDescending ? (dateB - dateA) : (dateA - dateB);\n    });\n  }\n\n  toggleSortOrder() {\n    this.sortDescending = !this.sortDescending;\n    this.sortFilesByDate();\n  } onFileSelected(event: any) {\n    this.selectedFile = event.target.files[0];\n  }\n\n  onUpload() {\n    if (this.selectedFile) {\n      this.storageService.uploadFile(this.selectedFile).subscribe((response: UploadResponse) => {\n        // 將上傳的檔案資訊加入到列表中\n        this.uploadedFiles.push({\n          uuidFileName: response.uuidFileName,\n          originalFileName: response.originalFileName\n        });\n        this.loadFiles();\n        this.selectedFile = null;\n      });\n    }\n  }\n\n  downloadFile(uuidFileName: string) {\n    // 使用簡化的下載方法，直接開啟下載連結\n    this.storageService.downloadFile(uuidFileName);\n  }\n\n  // 如果需要更複雜的下載處理，可以使用這個方法\n  downloadFileAsBlob(uuidFileName: string) {\n    this.storageService.downloadFileAsBlob(uuidFileName).subscribe((blob: Blob) => {\n      const a = document.createElement('a');\n      const objectUrl = URL.createObjectURL(blob);\n      a.href = objectUrl;\n      a.download = `downloaded_${uuidFileName}`; // 使用 UUID 作為預設檔案名稱\n      a.click();\n      URL.revokeObjectURL(objectUrl);\n    });\n  }\n\n  deleteFile(uuidFileName: string) {\n    this.storageService.deleteFile(uuidFileName).subscribe(() => {\n      // 從本地列表中移除已刪除的檔案\n      this.uploadedFiles = this.uploadedFiles.filter(f => f.uuidFileName !== uuidFileName);\n      this.loadFiles();\n    });\n  }\n}\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}