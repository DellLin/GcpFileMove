{"ast":null,"code":"import * as i0 from \"@angular/core\";\nimport * as i1 from \"./storage.service\";\nimport * as i2 from \"@angular/common\";\nfunction AppComponent_tr_32_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r7 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"td\");\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"td\");\n    i0.ɵɵtext(6);\n    i0.ɵɵpipe(7, \"number\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"td\");\n    i0.ɵɵtext(9);\n    i0.ɵɵpipe(10, \"date\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(11, \"td\")(12, \"button\", 13);\n    i0.ɵɵlistener(\"click\", function AppComponent_tr_32_Template_button_click_12_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r7);\n      const file_r5 = restoredCtx.$implicit;\n      const ctx_r6 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r6.downloadFile(file_r5.uuidFileName));\n    });\n    i0.ɵɵtext(13, \"Download\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(14, \"button\", 14);\n    i0.ɵɵlistener(\"click\", function AppComponent_tr_32_Template_button_click_14_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r7);\n      const file_r5 = restoredCtx.$implicit;\n      const ctx_r8 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r8.deleteFile(file_r5.uuidFileName));\n    });\n    i0.ɵɵtext(15, \"Delete\");\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const file_r5 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(file_r5.originalFileName);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(file_r5.uuidFileName);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(7, 4, file_r5.size));\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind2(10, 6, file_r5.uploadDate, \"short\"));\n  }\n}\nfunction AppComponent_div_33_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 9);\n    i0.ɵɵtext(1, \" No files found in storage. \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction AppComponent_tr_48_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r11 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"td\");\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"td\")(6, \"button\", 13);\n    i0.ɵɵlistener(\"click\", function AppComponent_tr_48_Template_button_click_6_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r11);\n      const file_r9 = restoredCtx.$implicit;\n      const ctx_r10 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r10.downloadFile(file_r9.uuidFileName));\n    });\n    i0.ɵɵtext(7, \"Download\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"button\", 14);\n    i0.ɵɵlistener(\"click\", function AppComponent_tr_48_Template_button_click_8_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r11);\n      const file_r9 = restoredCtx.$implicit;\n      const ctx_r12 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r12.deleteFile(file_r9.uuidFileName));\n    });\n    i0.ɵɵtext(9, \"Delete\");\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const file_r9 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(file_r9.originalFileName);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(file_r9.uuidFileName);\n  }\n}\nfunction AppComponent_div_49_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 9);\n    i0.ɵɵtext(1, \" No files uploaded in this session. \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction AppComponent_tr_62_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r15 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"td\")(4, \"button\", 13);\n    i0.ɵɵlistener(\"click\", function AppComponent_tr_62_Template_button_click_4_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r15);\n      const file_r13 = restoredCtx.$implicit;\n      const ctx_r14 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r14.downloadFile(file_r13.name));\n    });\n    i0.ɵɵtext(5, \"Download\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"button\", 14);\n    i0.ɵɵlistener(\"click\", function AppComponent_tr_62_Template_button_click_6_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r15);\n      const file_r13 = restoredCtx.$implicit;\n      const ctx_r16 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r16.deleteFile(file_r13.name));\n    });\n    i0.ɵɵtext(7, \"Delete\");\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const file_r13 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(file_r13.name);\n  }\n}\nexport let AppComponent = /*#__PURE__*/(() => {\n  class AppComponent {\n    constructor(storageService) {\n      this.storageService = storageService;\n      this.title = 'app';\n      this.files = [];\n      this.filesWithMetadata = []; // 帶有原始檔案名稱的檔案列表\n      this.selectedFile = null;\n      this.uploadedFiles = []; // 儲存上傳的檔案資訊\n    }\n\n    ngOnInit() {\n      this.loadFiles();\n    }\n    loadFiles() {\n      // 載入原始的檔案列表（舊版 API）\n      this.storageService.getFileList().subscribe(data => {\n        this.files = data.items || [];\n      });\n      // 載入帶有元數據的檔案列表（新版 API）\n      this.storageService.getFileListWithMetadata().subscribe(data => {\n        // 按上傳日期排序，最新的在前面\n        this.filesWithMetadata = data.sort((a, b) => {\n          const dateA = new Date(a.uploadDate).getTime();\n          const dateB = new Date(b.uploadDate).getTime();\n          return dateB - dateA; // 降序排列（最新的在前面）\n        });\n      });\n    }\n\n    onFileSelected(event) {\n      this.selectedFile = event.target.files[0];\n    }\n    onUpload() {\n      if (this.selectedFile) {\n        this.storageService.uploadFile(this.selectedFile).subscribe(response => {\n          // 將上傳的檔案資訊加入到列表中\n          this.uploadedFiles.push({\n            uuidFileName: response.uuidFileName,\n            originalFileName: response.originalFileName\n          });\n          this.loadFiles();\n          this.selectedFile = null;\n        });\n      }\n    }\n    downloadFile(uuidFileName) {\n      // 使用簡化的下載方法，直接開啟下載連結\n      this.storageService.downloadFile(uuidFileName);\n    }\n    // 如果需要更複雜的下載處理，可以使用這個方法\n    downloadFileAsBlob(uuidFileName) {\n      this.storageService.downloadFileAsBlob(uuidFileName).subscribe(blob => {\n        const a = document.createElement('a');\n        const objectUrl = URL.createObjectURL(blob);\n        a.href = objectUrl;\n        a.download = `downloaded_${uuidFileName}`; // 使用 UUID 作為預設檔案名稱\n        a.click();\n        URL.revokeObjectURL(objectUrl);\n      });\n    }\n    deleteFile(uuidFileName) {\n      this.storageService.deleteFile(uuidFileName).subscribe(() => {\n        // 從本地列表中移除已刪除的檔案\n        this.uploadedFiles = this.uploadedFiles.filter(f => f.uuidFileName !== uuidFileName);\n        this.loadFiles();\n      });\n    }\n  }\n  AppComponent.ɵfac = function AppComponent_Factory(t) {\n    return new (t || AppComponent)(i0.ɵɵdirectiveInject(i1.StorageService));\n  };\n  AppComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: AppComponent,\n    selectors: [[\"app-root\"]],\n    decls: 63,\n    vars: 6,\n    consts: [[1, \"container\"], [1, \"card\", \"mb-4\"], [1, \"card-body\"], [1, \"card-title\"], [1, \"form-group\"], [\"type\", \"file\", 1, \"form-control-file\", 3, \"change\"], [1, \"btn\", \"btn-primary\", 3, \"disabled\", \"click\"], [1, \"card\"], [1, \"table\", \"table-striped\"], [1, \"text-muted\"], [4, \"ngFor\", \"ngForOf\"], [\"class\", \"text-muted\", 4, \"ngIf\"], [1, \"card\", \"mt-4\"], [1, \"btn\", \"btn-success\", \"btn-sm\", \"mr-2\", 3, \"click\"], [1, \"btn\", \"btn-danger\", \"btn-sm\", 3, \"click\"]],\n    template: function AppComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"body\")(1, \"div\", 0)(2, \"h1\");\n        i0.ɵɵtext(3, \"GCP Storage File Management\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(4, \"div\", 1)(5, \"div\", 2)(6, \"h5\", 3);\n        i0.ɵɵtext(7, \"Upload File\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(8, \"div\", 4)(9, \"input\", 5);\n        i0.ɵɵlistener(\"change\", function AppComponent_Template_input_change_9_listener($event) {\n          return ctx.onFileSelected($event);\n        });\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(10, \"button\", 6);\n        i0.ɵɵlistener(\"click\", function AppComponent_Template_button_click_10_listener() {\n          return ctx.onUpload();\n        });\n        i0.ɵɵtext(11, \"Upload\");\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵelementStart(12, \"div\", 7)(13, \"div\", 2)(14, \"h5\", 3);\n        i0.ɵɵtext(15, \"All Files with Original Names\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(16, \"table\", 8)(17, \"thead\")(18, \"tr\")(19, \"th\");\n        i0.ɵɵtext(20, \"Original File Name\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(21, \"th\");\n        i0.ɵɵtext(22, \"UUID File Name\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(23, \"th\");\n        i0.ɵɵtext(24, \"Size (bytes)\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(25, \"th\");\n        i0.ɵɵtext(26, \"Upload Date \");\n        i0.ɵɵelementStart(27, \"small\", 9);\n        i0.ɵɵtext(28, \"(\\u2193 Newest First)\");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(29, \"th\");\n        i0.ɵɵtext(30, \"Actions\");\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵelementStart(31, \"tbody\");\n        i0.ɵɵtemplate(32, AppComponent_tr_32_Template, 16, 9, \"tr\", 10);\n        i0.ɵɵelementEnd()();\n        i0.ɵɵtemplate(33, AppComponent_div_33_Template, 2, 0, \"div\", 11);\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(34, \"div\", 12)(35, \"div\", 2)(36, \"h5\", 3);\n        i0.ɵɵtext(37, \"Recently Uploaded Files (This Session)\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(38, \"table\", 8)(39, \"thead\")(40, \"tr\")(41, \"th\");\n        i0.ɵɵtext(42, \"Original File Name\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(43, \"th\");\n        i0.ɵɵtext(44, \"UUID File Name\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(45, \"th\");\n        i0.ɵɵtext(46, \"Actions\");\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵelementStart(47, \"tbody\");\n        i0.ɵɵtemplate(48, AppComponent_tr_48_Template, 10, 2, \"tr\", 10);\n        i0.ɵɵelementEnd()();\n        i0.ɵɵtemplate(49, AppComponent_div_49_Template, 2, 0, \"div\", 11);\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(50, \"div\", 12)(51, \"div\", 2)(52, \"h5\", 3);\n        i0.ɵɵtext(53, \"Raw Storage API Response\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(54, \"table\", 8)(55, \"thead\")(56, \"tr\")(57, \"th\");\n        i0.ɵɵtext(58, \"File Name (UUID)\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(59, \"th\");\n        i0.ɵɵtext(60, \"Actions\");\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵelementStart(61, \"tbody\");\n        i0.ɵɵtemplate(62, AppComponent_tr_62_Template, 8, 1, \"tr\", 10);\n        i0.ɵɵelementEnd()()()()()();\n      }\n      if (rf & 2) {\n        i0.ɵɵadvance(10);\n        i0.ɵɵproperty(\"disabled\", !ctx.selectedFile);\n        i0.ɵɵadvance(22);\n        i0.ɵɵproperty(\"ngForOf\", ctx.filesWithMetadata);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.filesWithMetadata.length === 0);\n        i0.ɵɵadvance(15);\n        i0.ɵɵproperty(\"ngForOf\", ctx.uploadedFiles);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.uploadedFiles.length === 0);\n        i0.ɵɵadvance(13);\n        i0.ɵɵproperty(\"ngForOf\", ctx.files);\n      }\n    },\n    dependencies: [i2.NgForOf, i2.NgIf, i2.DecimalPipe, i2.DatePipe],\n    encapsulation: 2\n  });\n  return AppComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}